# Приложение "Звездное Предсказание"

Веб-сервис для генерации персонализированных гороскопов с использованием искусственного интеллекта Google Gemini API.

## Содержание

- [Описание](#описание)
- [Возможности](#возможности)
- [Структура проекта](#структура-проекта)
- [Технологии](#технологии)
- [Установка и настройка](#установка-и-настройка)
- [API endpoints](#api-endpoints)
- [Переменные окружения](#переменные-окружения)
- [Запуск приложения](#запуск-приложения)
- [Деплой на продакшн](#деплой-на-продакшн)
- [Работа с Google Gemini API](#работа-с-google-gemini-api)
- [Механизм резервного предсказания](#механизм-резервного-предсказания)

## Описание

"Звездное Предсказание" — это веб-приложение для получения персонализированных гороскопов на базе технологий TypeScript и Express. Приложение использует Google Gemini API для генерации уникальных предсказаний или, в случае недоступности API, предоставляет гороскопы на основе алгоритма псевдослучайной генерации.

## Возможности

- Получение гороскопов по знаку зодиака
- Получение гороскопов по дате рождения
- Предсказания на разные периоды времени (сегодня, завтра, неделя, месяц)
- Генерация уникальных предсказаний с помощью AI (при наличии API ключа)
- Резервный механизм предсказаний при отсутствии подключения к AI
- Информация о совместимости знаков
- Счастливые числа и настроение дня

## Структура проекта

```
/
├── dist/                  # Скомпилированные файлы для продакшена
├── src/                   # Исходный код приложения
│   ├── models/            # Модели и типы данных
│   │   └── zodiac.ts      # Перечисления и типы для знаков зодиака
│   ├── public/            # Статические файлы для веб-интерфейса
│   │   ├── index.html     # HTML страница приложения  
│   │   ├── styles.css     # Стили приложения
│   │   └── script.js      # JavaScript для веб-интерфейса
│   ├── routes/            # Маршруты API
│   │   └── horoscopeRoutes.ts # Обработчики запросов для гороскопов
│   ├── services/          # Сервисы для бизнес-логики
│   │   ├── geminiService.ts   # Взаимодействие с Google Gemini API
│   │   ├── horoscopeService.ts # Основной сервис для генерации гороскопов
│   │   └── pseudoRandomHoroscope.ts # Резервный генератор предсказаний
│   └── index.ts           # Точка входа приложения
├── .env                   # Файл переменных окружения
├── ecosystem.config.js    # Конфигурация для PM2
├── package.json           # Зависимости и скрипты проекта
└── tsconfig.json          # Конфигурация TypeScript
```

## Технологии

- **TypeScript**: Типизированный JavaScript для улучшения разработки
- **Express**: Веб-фреймворк для Node.js
- **Google Gemini API**: Модель искусственного интеллекта для генерации предсказаний
- **Node-fetch**: Для выполнения HTTP-запросов к внешним API
- **PM2**: Менеджер процессов для запуска в продакшене
- **Bootstrap**: Фронтенд-фреймворк для стилизации интерфейса
- **HTML/CSS/JavaScript**: Для клиентской части приложения

## Установка и настройка

### Системные требования

- Node.js (рекомендуется 18.x или выше)
- npm (рекомендуется 8.x или выше)

### Установка зависимостей

```bash
npm install
```

### Настройка переменных окружения

Создайте файл `.env` в корневой директории проекта со следующими переменными:

```
PORT=5000
NODE_ENV=development
GOOGLE_API_KEY=ваш_api_ключ_здесь
USE_DYNAMIC_HOROSCOPE=true
```

## API endpoints

### Получение гороскопа по знаку зодиака

```
GET /api/v1/horoscope/:sign?time_frame=сегодня
```

Параметры:
- `sign`: знак зодиака (aries, taurus, gemini, cancer, leo, virgo, libra, scorpio, sagittarius, capricorn, aquarius, pisces)
- `time_frame`: временной период (сегодня, завтра, неделя, месяц)

Пример запроса:
```
GET /api/v1/horoscope/aries?time_frame=сегодня
```

### Получение гороскопа по дате рождения

```
GET /api/v1/date/:month/:day?time_frame=сегодня
```

Параметры:
- `month`: месяц рождения (1-12)
- `day`: день рождения (1-31)
- `time_frame`: временной период (сегодня, завтра, неделя, месяц)

Пример запроса:
```
GET /api/v1/date/3/21?time_frame=неделя
```

### Формат ответа

```json
{
  "sign": "aries",
  "date": "2025-05-13",
  "prediction": "Текст предсказания...",
  "lucky_numbers": [7, 12, 23, 42, 85],
  "compatibility": "leo",
  "mood": "Творческое",
  "time_frame": "сегодня"
}
```

## Переменные окружения

| Переменная | Описание | Значения по умолчанию |
|------------|----------|-----------------------|
| PORT | Порт для запуска сервера | 5000 |
| NODE_ENV | Окружение приложения | development |
| GOOGLE_API_KEY | API ключ для Google Gemini | - |
| USE_DYNAMIC_HOROSCOPE | Использовать ли AI для генерации | true |

## Запуск приложения

### Режим разработки

```bash
npm run dev
```

### Сборка для продакшена

```bash
npm run build
```

### Запуск в продакшене

```bash
npm start
```

### Запуск через PM2

```bash
npm run pm2
```

## Деплой на продакшн

### Подготовка к деплою

1. Установите все зависимости:
   ```bash
   npm install
   ```

2. Соберите проект:
   ```bash
   npm run build
   ```

3. Настройте файл `.env` для продакшена:
   ```
   PORT=5000
   NODE_ENV=production
   GOOGLE_API_KEY=ваш_api_ключ_здесь
   USE_DYNAMIC_HOROSCOPE=true
   ```

### Запуск на сервере

1. Запустите приложение через PM2:
   ```bash
   npm run pm2
   ```

2. Для мониторинга состояния:
   ```bash
   npx pm2 status
   ```

3. Для просмотра логов:
   ```bash
   npx pm2 logs horoscope-app
   ```

4. Для перезапуска приложения:
   ```bash
   npx pm2 restart horoscope-app
   ```

## Работа с Google Gemini API

Для генерации качественных предсказаний приложение использует Google Gemini API. Для работы с API необходимо:

1. Получить API ключ на платформе [Google AI Studio](https://makersuite.google.com/)
2. Добавить полученный ключ в переменную окружения `GOOGLE_API_KEY`

Конфигурация запросов к API находится в файле `src/services/geminiService.ts`. Текущая реализация использует модель `gemini-2.0-flash` для быстрой генерации коротких предсказаний. 

Параметры запроса можно настроить в методе `generateHoroscope`:
- temperature: контролирует креативность генерации (0.7 по умолчанию)
- topK и topP: параметры выборки следующего токена
- maxOutputTokens: максимальная длина ответа (500 по умолчанию)

## Механизм резервного предсказания

В случае недоступности Google Gemini API (отсутствие ключа, проблемы с подключением и т.д.), приложение использует алгоритм псевдослучайной генерации предсказаний, реализованный в файле `src/services/pseudoRandomHoroscope.ts`.

Этот механизм обеспечивает:
- Стабильность предсказаний (один знак получает одинаковое предсказание в течение дня)
- Уникальность предсказаний для разных знаков и временных периодов
- Тематическое соответствие характеристикам знака зодиака
- Разнообразие формулировок и тем предсказаний

Алгоритм использует seed-based рандомизацию на основе текущей даты, что позволяет получать разные предсказания каждый день, но сохранять их стабильность в течение дня.